<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Docker-freeradius by ramelito</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Docker-freeradius</h1>
        <p>Freeradius docker container</p>

        <p class="view"><a href="https://github.com/ramelito/docker-freeradius">View the Project on GitHub <small>ramelito/docker-freeradius</small></a></p>


        <ul>
          <li><a href="https://github.com/ramelito/docker-freeradius/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/ramelito/docker-freeradius/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/ramelito/docker-freeradius">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="background" class="anchor" href="#background" aria-hidden="true"><span class="octicon octicon-link"></span></a>Background</h1>

<p>Sometimes for testing purposes network engineer needs to deploy small RADIUS server with SQL backend and some sort of web management. It can take from one hour or up to a whole day, just because since last time network engineer had done it, technology moved forward and this time one will account for new cobweb. So spending time on IT management should be minimal as much as possible. This article is about how to deploy Freeradius application with MySQL as backend and PMA as web management in short order. Short, I mean, are several minutes.</p>

<h1>
<a id="action" class="anchor" href="#action" aria-hidden="true"><span class="octicon octicon-link"></span></a>Action</h1>

<p>Imagine you have a root access to Linux machine with Internet connection. It does not matter it's virtual or physical. I would prefer to manage box with deadly simple orcherstration tool - Ansible. So you've better to have it on the box.</p>

<ol>
<li>Installing Ansible.</li>
</ol>

<p>Install packages.</p>

<div class="highlight highlight-bash"><pre>apt-get -y update
apt-get install -y python-yaml python-jinja2 python-httplib2 python-keyczar python-paramiko python-setuptools python-pkg-resources git python-pip</pre></div>

<p>Clone current ansible from Github.</p>

<div class="highlight highlight-bash"><pre>git clone http://github.com/ansible/ansible.git
<span class="pl-s3">cd</span> ansible
git submodule update --init</pre></div>

<p>Source ansible environment.</p>

<div class="highlight highlight-bash"><pre><span class="pl-s3">.</span> ./hacking/env-setup</pre></div>

<p>Create global inventory file with localhost.</p>

<div class="highlight highlight-bash"><pre><span class="pl-s3">echo</span> <span class="pl-s1"><span class="pl-pds">'</span>[local]\nlocalhost\n<span class="pl-pds">'</span></span> <span class="pl-k">&gt;</span> /etc/ansible/hosts</pre></div>

<ol>
<li>Installing Docker.</li>
</ol>

<p>Next step is to install fresh Docker ecosystem. If you do not already installed proceed with this recipe.</p>

<div class="highlight highlight-bash"><pre>ansible-galaxy install angstwad.docker_ubuntu</pre></div>

<p>Create simple playbook with your favorite text editor...</p>

<div class="highlight highlight-bash"><pre>cat /tmp/docker.yml</pre></div>

<div class="highlight highlight-yml"><pre><span class="pl-s1">-<span class="pl-s1">--</span></span>
<span class="pl-s1">- <span class="pl-s1">hosts:local</span></span>
 <span class="pl-s1"><span class="pl-ent"> connection:</span> <span class="pl-s1">local</span></span>
 <span class="pl-s1"><span class="pl-ent"> roles:</span></span>
    <span class="pl-s1">- <span class="pl-s1">angstwad.docker_ubuntu</span></span></pre></div>

<p>... and just execute it.</p>

<div class="highlight highlight-bash"><pre>ansible-playbook /tmp/docker.yml</pre></div>

<p>Now you should have fresh and up-to-date Docker.</p>

<ol>
<li>Dockerize it.</li>
</ol>

<p>So here where really magic begins. We create playbook with three simple tasks. These tasks actually will start MySQL, PMA and Freeradius. On the output you will get three running containers connected to each other and ready to serve.</p>

<p>Once again take your favorite editor and create following playbook:</p>

<div class="highlight highlight-bash"><pre>cat fr_mysql_pma.yml </pre></div>

<div class="highlight highlight-yml"><pre><span class="pl-s1">-<span class="pl-s1">--</span></span>
<span class="pl-s1">- <span class="pl-ent">hosts:</span> <span class="pl-s1">local</span></span>
 <span class="pl-s1"><span class="pl-ent"> connection:</span> <span class="pl-s1">local</span></span>
 <span class="pl-s1"><span class="pl-ent"> vars:</span></span>
 <span class="pl-s1"><span class="pl-ent">   - mysql_root_pass:</span> <span class="pl-s1">password123  </span></span>

 <span class="pl-s1"><span class="pl-ent"> tasks:</span></span>
 <span class="pl-s1"><span class="pl-ent">   - name:</span> <span class="pl-s1">Start MySQL</span></span>
 <span class="pl-s1"><span class="pl-ent">     docker:</span> <span class="pl-s1">image=mysql name=freeradius-mysql volumes="/var/lib/mysql:volumes/mysql" env="MYSQL_ROOT_PASSWORD={{ mysql_root_pass }}"</span></span>

 <span class="pl-s1"><span class="pl-ent">   - name:</span> <span class="pl-s1">Start PMA</span></span>
 <span class="pl-s1"><span class="pl-ent">     docker:</span> <span class="pl-s1">image=corbinu/docker-phpmyadmin name=pma env="MYSQL_USERNAME=root" links=freeradius-mysql:mysql ports=80:80</span></span>

 <span class="pl-s1"><span class="pl-ent">   - name:</span> <span class="pl-s1">Start Freeradius</span></span>
 <span class="pl-s1"><span class="pl-ent">     docker:</span> <span class="pl-s1">image=ramelito/docker-freeradius name=frv2 links=freeradius-mysql:mysql ports=1812:1812/udp,1813:1813/udp command="freeradius -f"</span></span></pre></div>

<p>Run it:</p>

<div class="highlight highlight-bash"><pre>ansible-playbook fr_mysql_pma.yml</pre></div>

<p>Check it:</p>

<div class="highlight highlight-bash"><pre>docker ps -a
CONTAINER ID        IMAGE                               COMMAND                CREATED             STATUS              PORTS                                            NAMES
fc250eae3986        ramelito/docker-freeradius:latest   <span class="pl-s1"><span class="pl-pds">"</span>./entrypoint.sh fre   7 minutes ago       Up 7 minutes        0.0.0.0:1812-&gt;1812/udp, 0.0.0.0:1813-&gt;1813/udp   frv2                </span>
<span class="pl-s1">5526ad668362        corbinu/docker-phpmyadmin:latest    <span class="pl-pds">"</span></span>/bin/sh -c phpmyadm   About an hour ago   Up About an hour    0.0.0.0:80-<span class="pl-k">&gt;</span>80/tcp                               pma                 
bdaf6aeaf452        mysql:latest                        <span class="pl-s1"><span class="pl-pds">"</span>/entrypoint.sh mysq   About an hour ago   Up About an hour    3306/tcp                                         freeradius-mysql  </span></pre></div>

<h1>
<a id="conclusion" class="anchor" href="#conclusion" aria-hidden="true"><span class="octicon octicon-link"></span></a>Conclusion</h1>

<p>This relatively simple and timesaving scenario does not require much from user's experience and can be easily deployed either inside virtualbox image or physical lab machine. Have a nice BRASing.</p>

<h1>
<a id="references" class="anchor" href="#references" aria-hidden="true"><span class="octicon octicon-link"></span></a>References</h1>

<p><a href="http://www.ansible.com/2014/02/12/installing-and-building-docker-with-ansible">http://www.ansible.com/2014/02/12/installing-and-building-docker-with-ansible</a>
<a href="https://docs.docker.com/userguide/dockerlinks/">https://docs.docker.com/userguide/dockerlinks/</a>
<a href="http://wiki.freeradius.org/guide/FAQ">http://wiki.freeradius.org/guide/FAQ</a></p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/ramelito">ramelito</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>