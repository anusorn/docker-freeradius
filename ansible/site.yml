---
- hosts: localhost

  tasks:
    - name: Add unofficial freeradius repository
      apt_repository: repo='ppa:freeradius/stable' update_cache=yes

    - name: install freeradius packages
      apt: name={{ item }} state=present
      with_items:
        - freeradius
        - freeradius-mysql
        - python-mysqldb
        - mysql-client

    - name: Create temp dir of ssl private dir
      file: state=directory path=/etc/ssl/private-copy

    - name: Copy /etc/ssl/private/* to /etc/ssl/private-copy/
      shell: mv /etc/ssl/private/* /etc/ssl/private-copy/

    - name: Remove ssl private dir
      file: state=absent path=/etc/ssl/private

    - name: Copy /etc/ssl/private-copy to /etc/ssl/private
      shell: mv /etc/ssl/private-copy /etc/ssl/private

    - name: Set priveledges for ssl private dir
      file: path=/etc/ssl/private mode=0700 owner=freerad
